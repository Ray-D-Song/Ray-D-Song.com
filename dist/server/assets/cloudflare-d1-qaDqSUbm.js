import { mergeProps, useSSRContext } from "vue";
import { ssrRenderAttrs, ssrRenderStyle, ssrRenderAttr } from "vue/server-renderer";
import { _ as _imports_0 } from "./copy-Z7yAKeMK.js";
const title = "cloudflare worker/D1 初探";
const intro = "最近想给博客加个访问量展示, 因为网站本身套了一层 cf, 自然想到用 cf 的 serverless 方案, 也就是 worker.";
const time = "2023-11-18";
const tag = "Serverless";
const _sfc_main = {
  __name: "cloudflare-d1",
  __ssrInlineRender: true,
  setup(__props, { expose: __expose }) {
    const frontmatter = { "title": "cloudflare worker/D1 初探", "intro": "最近想给博客加个访问量展示, 因为网站本身套了一层 cf, 自然想到用 cf 的 serverless 方案, 也就是 worker.", "time": "2023-11-18", "tag": "Serverless" };
    __expose({ frontmatter });
    return (_ctx, _push, _parent, _attrs) => {
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "markdown-body" }, _attrs))}><h1>创建项目</h1><p>如果是第一次使用 worker 服务, 需要登录一下</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npx wrangler login
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> wrangler login</span></span>
<span class="line"></span></code></pre><p>通过命令行交互创建一个名为 event-tracking 的项目</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npm create cloudflare@latest event-tracking
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npm</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> create cloudflare@latest event-tracking</span></span>
<span class="line"></span></code></pre><p>项目创建完成后有两个关键的文件, <code>src/index.ts</code> 是 worker 的入口, <code>wrangler.toml</code> 是总的配置文件.<br> 进入 dev01 目录, 执行命令创建数据库</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npx wrangler d1 create event-tracking-db
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> wrangler d1 create event-tracking-db</span></span>
<span class="line"></span></code></pre><p>执行上面的命令会生成类似如下内容, 粘贴到<code>wrangler.toml</code>中即可配置项目的数据库连接</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">toml</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="[[d1_databases]]
binding = &quot;DB&quot;
database_name = &quot;event-tracking-db&quot;
database_id = &quot;xxxxxxxxx-xxxxx-xxxx-xxxx-xxxxxxxxxxxxx&quot;
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">[[</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}">d1_databases</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">]]</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">binding</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &quot;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">DB</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">database_name</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &quot;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">event-tracking-db</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">database_id</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &quot;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">xxxxxxxxx-xxxxx-xxxx-xxxx-xxxxxxxxxxxxx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span></span>
<span class="line"></span></code></pre><p>在项目的根目录下创建 sql/schema.sql 文件用于初始化数据库</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">sql</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="DROP TABLE IF EXISTS view_tracking;

CREATE TABLE IF NOT EXISTS view_tracking
(article_id CHAR(13) PRIMARY KEY, view_count INT);

INSERT INTO view_tracking (article_id, view_count) values (&#39;1692667782462&#39;, 1);
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">DROP</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> TABLE</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> IF</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> EXISTS</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}"> view_tracking;</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">CREATE</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> TABLE</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> IF</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> NOT</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> EXISTS</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}"> view_tracking</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">(article_id </span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">CHAR</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">(</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">13</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">) </span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">PRIMARY KEY</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">, view_count </span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">INT</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">);</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">INSERT INTO</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}"> view_tracking (article_id, view_count) </span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">values</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}"> (</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">1692667782462</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">, </span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">1</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#A9B1D6" })}">);</span></span>
<span class="line"></span></code></pre><p>执行以下命令在本地创建数据库进行测试</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npx wrangler d1 execute event-tracking-db --local --file=./sql/schema.sql
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> wrangler d1 execute event-tracking-db --local --file=./sql/schema.sql</span></span>
<span class="line"></span></code></pre><p>所谓本地数据库其实是<code>.wrangler/state/d1/miniflare-D1DatabaseObject</code>文件夹下创建了一个 sqlite.<br> 所以你可以用自己的数据库软件比如 datagrip 验证操作是否成功.</p><h1>worker 操作数据库</h1><p>我的需求是每次用户访问文章, 前端将文章拼接在路径参数中请求后端, 后端为文章的阅读量 + 1 后返回阅读量给前端.<br> 修改我们的 worker 文件, 先完成获取 articleId 并将其原样返回的步骤.</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="export default {
	async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise&lt;Response&gt; {
    const articleId = request.url.split(&#39;/&#39;).pop()

		return new Response(articleId)
	}
}
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> default</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">	async</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> fetch</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Request</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> ctx</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> ExecutionContext</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Promise</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&lt;</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}">Response</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">split</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">/</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">pop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">		return</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> new</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> Response</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">	}</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span></code></pre><h2>单测</h2><p>接下来我们对这个简单的 worker 运行测试.<br> 我这里选择使用 Vitest, 它和 TS 的集成度更高且性能更好. 你可以通过我这篇文章来了解它<a href="https://ray-d-song.com/post/1701870426245">在 Vue 项目中使用 Vitest</a></p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="import { unstable_dev, type UnstableDevWorker } from &#39;wrangler&#39;
import { describe, beforeAll, afterAll, it, expect } from &#39;vitest&#39;

describe(&#39;Event Tracking&#39;, () =&gt; {
  let worker: UnstableDevWorker

  beforeAll(async () =&gt; {
    worker = await unstable_dev(&#39;src/index.ts&#39;, {
      experimental: { disableExperimentalWarning: true }
    })
  })

  afterAll(async () =&gt; {
    await worker?.stop()
  })

  it(&#39;should return path param&#39;, async () =&gt; {
    const response = await worker.fetch(&#39;https://thorn.com/post/1701870426245&#39;)
    const str = await response.text()
    expect(str).toBe(&#39;1701870426245&#39;)
  })

})
/**
 *  Test Files  1 passed (1)
 *  Tests  1 passed (1)
 *  Start at  10:59:31
 *  Duration  524ms
 */
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> unstable_dev</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> type</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> UnstableDevWorker</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">wrangler</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> describe</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> beforeAll</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> afterAll</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> it</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> expect</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">vitest</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">describe</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">Event Tracking</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  let</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> UnstableDevWorker</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  beforeAll</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">    worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> unstable_dev</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">src/index.ts</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#73DACA" })}">      experimental</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#73DACA" })}"> disableExperimentalWarning</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> true</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">    }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  afterAll</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">?.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">stop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  it</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">should return path param</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">fetch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">https://thorn.com/post/1701870426245</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> str</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">text</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">    expect</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">str</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">toBe</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">1701870426245</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *  Test Files  1 passed (1)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *  Tests  1 passed (1)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *  Start at  10:59:31</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *  Duration  524ms</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> */</span></span>
<span class="line"></span></code></pre><h2>查询</h2><p>在创建数据库时, 我们插入了初试数据, 利用这个数据进行查询测试:</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="/** index.ts */
export default {
	async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise&lt;Response&gt; {
    const articleId = request.url.split(&#39;/&#39;).pop()

    const result = await env.DB.prepare(
      &#39;SELECT view_count FROM view_tracking WHERE article_id = ?&#39;
    )
      .bind(articleId)
      .first()
    
		return new Response(String(result===null?0:result[&#39;view_count&#39;]))
	}
}

/** index.test.ts */

// 将第一个用例标记为 skit, 跳过该测试
it.skip(&#39;should return path param&#39;, async () =&gt; {
  const response = await worker.fetch(&#39;https://thorn.com/post/1701870426245&#39;)
  const str = await response.text()
  expect(str).toBe(&#39;1701870426245&#39;)
})

it(&quot;should return &#39;1&#39;&quot;, async () =&gt; {
  const response = await worker.fetch(&#39;https://thorn.com/post/1692667782462&#39;)
  const str = await response.text()
  expect(str).toBe(&#39;1&#39;)
})

/**
 *  ✓ src/index.test.ts (2)
 *  ✓ Event Tracking (2)
 *    ↓ should return path param [skipped]
 *    ✓ should return &#39;1&#39;
*/
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> index.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> default</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">	async</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> fetch</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Request</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> ctx</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> ExecutionContext</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Promise</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&lt;</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}">Response</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">split</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">/</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">pop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> result</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">DB</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">prepare</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">      &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">SELECT view_count FROM view_tracking WHERE article_id = ?</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">    )</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">      .</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">bind</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">      .</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">first</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9ABDF5" })}">    </span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">		return</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> new</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> Response</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">String</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">result</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">===</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">null</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">?</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">0</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">:</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">result</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">view_count</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]))</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">	}</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> index.test.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">//</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> 将第一个用例标记为 skit, 跳过该测试</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">it</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">skip</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">should return path param</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">fetch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">https://thorn.com/post/1701870426245</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> str</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">text</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  expect</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">str</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">toBe</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">1701870426245</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">it</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">should return &#39;1&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">fetch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">https://thorn.com/post/1692667782462</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> str</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">text</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  expect</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">str</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">toBe</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">1</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *  ✓ src/index.test.ts (2)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *  ✓ Event Tracking (2)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *    ↓ should return path param [skipped]</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> *    ✓ should return &#39;1&#39;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"></span></code></pre><h2>更新</h2><p>我们继续在此基础上修改, 在查询数据前, 我们需要为该数据的阅读数 + 1.<br> 该连续操作并不需要强一致, 因此只需要在之前的操作前再加一条更新操作即可. D1 提供了自己的批处理语法.</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="/** index.ts */
export default {
	async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise&lt;Response&gt; {
    const articleId = request.url.split(&#39;/&#39;).pop()

    const db = env.DB
    const batchRes = await db.batch([
      db.prepare(&#39;UPDATE view_tracking SET view_count=view_count+1 WHERE article_id = ?&#39;).bind(articleId),
      db.prepare(&#39;SELECT view_count FROM view_tracking WHERE article_id = ?&#39;).bind(articleId)
    ])

    const viewCountVal = batchRes[1]===null ? 0 : (batchRes[1].results[0] as ViewCountObj)[&#39;view_count&#39;]
		return new Response(String(viewCountVal))
	}
}
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> index.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> default</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">	async</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> fetch</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Request</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> ctx</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> ExecutionContext</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Promise</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&lt;</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}">Response</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">split</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">/</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">pop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#FF9E64", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">DB</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> batchRes</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">batch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">([</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">      db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">prepare</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">UPDATE view_tracking SET view_count=view_count+1 WHERE article_id = ?</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">bind</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">      db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">prepare</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">SELECT view_count FROM view_tracking WHERE article_id = ?</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">bind</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> viewCountVal</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> batchRes</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">1</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">===</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">null</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> ?</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 0</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> :</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}"> (</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">batchRes</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">1</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">results</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">0</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> as</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> ViewCountObj</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)[</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">view_count</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">		return</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> new</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> Response</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">String</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">viewCountVal</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">))</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">	}</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span></code></pre><p>为了测试每次请求阅读数是否真的+1, 本来应该提供一个新的只读接口, 但为了偷懒我们可以打印每次的结果, 自己观察一下即可:</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="/** index.test.ts */
it(&quot;should return new view_count&quot;, async () =&gt; {
  const response = await worker.fetch(&#39;https://thorn.com/post/1692667782462&#39;)
  const str = await response.text()
  console.log(str)
  expect(str).toBeTypeOf(&#39;string&#39;)
})
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> index.test.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">it</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">should return new view_count</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">fetch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">https://thorn.com/post/1692667782462</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> str</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">text</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">  console</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">log</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">str</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  expect</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">str</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">toBeTypeOf</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">string</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span></code></pre><p>到这里该接口的编写基本完成.</p><h2>写入</h2><p>为了每次发布新的文章都自动插入数据, 我们还需要另一个插入数据接口.<br> 博客每次执行发布的 actions, 就调用该接口将新的 article_id 写入数据库.<br> 每个 worker 仅能完成一个工作, 需要的接口就需要创建新的 worker. 为了偷懒我们对之前的 worker 进行改造, 根据倒数第二个参数判断操作类型, 最后一个路径参数作为 article_id.</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="/** /src/index.ts */
import createHandler from &#39;./handlers/create&#39;
import readHandler from &#39;./handlers/read&#39;

export interface Env {
  DB: D1Database
}

export default {
  async fetch(request: Request, env: Env): Promise&lt;Response&gt; {
    try {
      const url = request.url.split(&#39;/&#39;)
      const articleId = url.pop()
      const handleType = url.pop()
      if(articleId?.length !== 13) {
        throw { code: 400, msg: &#39;err param&#39; }
      }
      switch (handleType){
        case &#39;read&#39;:
          return readHandler(articleId, env)
        case &#39;create&#39;:
          return createHandler(articleId, env)
        default:
          throw { code: 400, msg: &#39;err handle type&#39; }
      }
    } catch(e: any) {
      return new Response(e.msg, {status: e.code})
    }
  }
}

/** /src/handlers/create.ts */
import { Env } from &#39;..&#39;;

export default async function createHandler(articleId: string, env: Env) {
  const db = env.DB
  const execRes = await db.prepare(&#39;INSERT INTO view_tracking (article_id, view_count) values (?, 1)&#39;)
    .bind(articleId)
    .run()
  if(execRes.error) {
    throw { code: 500, msg: &#39;err exec&#39;}
  }
  return new Response(null, {status: 200})
}

/** /src/handlers/read.ts */
import { Env } from &#39;..&#39;

interface ViewCountObj {
  view_count: number
}

export default async function readHandler(articleId: string, env: Env): Promise&lt;Response&gt; {
  const db = env.DB
  const batchRes = await db.batch([
    db.prepare(&#39;UPDATE view_tracking SET view_count=view_count+1 WHERE article_id = ?&#39;).bind(articleId),
    db.prepare(&#39;SELECT view_count FROM view_tracking WHERE article_id = ?&#39;).bind(articleId)
  ])

  const viewCountVal = batchRes[1]===null ? 0 : (batchRes[1].results[0] as ViewCountObj)[&#39;view_count&#39;]
  return new Response(String(viewCountVal))
}
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> /src/index.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> createHandler</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">./handlers/create</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> readHandler</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">./handlers/read</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> interface</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#73DACA", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">  DB</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> D1Database</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> default</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  async</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> fetch</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Request</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Promise</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&lt;</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}">Response</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">    try</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">      const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> request</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">split</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">/</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">      const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">pop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">      const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> handleType</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> url</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">pop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">      if</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">?.</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#7DCFFF" })}">length</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> !==</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 13</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">        throw</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}"> code</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 400</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}"> msg</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">err param</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">      }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">      switch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}"> (</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">handleType</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">{</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">        case</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">read</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">          return</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> readHandler</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">        case</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">create</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">          return</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> createHandler</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">        default</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">          throw</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}"> code</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 400</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}"> msg</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">err handle type</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">      }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">    }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> catch</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">e</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#0DB9D7" })}"> any</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">      return</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> new</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> Response</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">e</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">msg</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}">status</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> e</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">code</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">    }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> /src/handlers/create.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">..</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">;</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> default</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> function</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> createHandler</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#0DB9D7" })}"> string</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#FF9E64", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">DB</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> execRes</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">prepare</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">INSERT INTO view_tracking (article_id, view_count) values (?, 1)</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">    .</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">bind</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">    .</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">run</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">  if</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">execRes</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">error</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">    throw</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}"> code</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 500</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}"> msg</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">err exec</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  return</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> new</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> Response</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">null</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#73DACA" })}">status</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 200</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> /src/handlers/read.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">..</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">interface</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> ViewCountObj</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#73DACA", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">  view_count</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#0DB9D7" })}"> number</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">export</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> default</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> function</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> readHandler</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#0DB9D7" })}"> string</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#907AA9", "--shiki-dark": "#E0AF68", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Env</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> Promise</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&lt;</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}">Response</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> env</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#FF9E64", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">DB</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> batchRes</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">batch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">([</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">    db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">prepare</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">UPDATE view_tracking SET view_count=view_count+1 WHERE article_id = ?</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">bind</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">    db</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">prepare</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">SELECT view_count FROM view_tracking WHERE article_id = ?</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">bind</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">articleId</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">  ])</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> viewCountVal</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> batchRes</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">1</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}">===</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">null</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> ?</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> 0</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> :</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}"> (</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">batchRes</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">1</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">results</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">[</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">0</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> as</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> ViewCountObj</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)[</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">view_count</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">]</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  return</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> new</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> Response</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">String</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">viewCountVal</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">))</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span></span>
<span class="line"></span></code></pre><p>对应的单测文件如下:</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">ts</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="/** /src/__test__/index.test.ts */
import { unstable_dev, type UnstableDevWorker } from &#39;wrangler&#39;
import { describe, beforeAll, afterAll, it, expect } from &#39;vitest&#39;

describe(&#39;Event Tracking&#39;, () =&gt; {
  let worker: UnstableDevWorker

  beforeAll(async () =&gt; {
    worker = await unstable_dev(&#39;src/index.ts&#39;, {
      experimental: { disableExperimentalWarning: true }
    })
  })

  afterAll(async () =&gt; {
    await worker?.stop()
  })

  // ...

  it(&#39;should return 200&#39;, async () =&gt; {
    const response = await worker.fetch(&#39;https://thorn.com/create/1701870426247&#39;)
    const code = response.status
    console.log(await response.text())
    expect(code).toBe(200)
  })
})
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">/**</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> /src/__test__/index.test.ts </span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">*/</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> unstable_dev</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> type</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> UnstableDevWorker</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">wrangler</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}">import</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> describe</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> beforeAll</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> afterAll</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> it</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#0DB9D7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> expect</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#7DCFFF" })}"> from</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}"> &#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">vitest</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">describe</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">Event Tracking</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">  let</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#56949F", "--shiki-dark": "#C0CAF5" })}"> UnstableDevWorker</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  beforeAll</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">    worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}"> unstable_dev</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">src/index.ts</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#73DACA" })}">      experimental</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#73DACA" })}"> disableExperimentalWarning</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">:</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}"> true</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> }</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">    }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  afterAll</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">?.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">stop</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}">  //</span><span style="${ssrRenderStyle({ "color": "#9893A5", "--shiki-dark": "#51597D", "font-style": "italic", "--shiki-dark-font-style": "italic" })}"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">  it</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">should return 200</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#89DDFF" })}">,</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> async</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> ()</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7" })}"> =&gt;</span><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}"> {</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}"> await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> worker</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">fetch</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">https://thorn.com/create/1701870426247</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&#39;</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#9D7CD8", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">    const</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#BB9AF7", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> code</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}"> =</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#7DCFFF", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">status</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">    console</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">log</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#BB9AF7", "font-style": "inherit", "--shiki-dark-font-style": "italic" })}">await</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}"> response</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">text</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">())</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">    expect</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#C0CAF5", "font-style": "italic", "--shiki-dark-font-style": "inherit" })}">code</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span><span style="${ssrRenderStyle({ "color": "#286983", "--shiki-dark": "#89DDFF" })}">.</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#7AA2F7" })}">toBe</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">(</span><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#FF9E64" })}">200</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">  }</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "color": "#797593", "--shiki-dark": "#9ABDF5" })}">}</span><span style="${ssrRenderStyle({ "color": "#575279", "--shiki-dark": "#9ABDF5" })}">)</span></span>
<span class="line"></span></code></pre><h1>部署</h1><p>首先将数据库创建 sql文件发布</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npx wrangler d1 execute event-tracking-db --file=./sql/schema.sql 
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> wrangler d1 execute event-tracking-db --file=./sql/schema.sql </span></span>
<span class="line"></span></code></pre><p>验证是否成功</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npx wrangler d1 execute event-tracking-db --command=&quot;SELECT * FROM view_tracking&quot;
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> wrangler d1 execute event-tracking-db --command=</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}">SELECT * FROM view_tracking</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#89DDFF" })}">&quot;</span></span>
<span class="line"></span></code></pre><p>不出意外会出现这玩意 <img src="https://r2.ray-d-song.com/202312151552033.png" alt="result image"> 最后发布你的 worker</p><pre class="shiki shiki-themes rose-pine-dawn tokyo-night" style="${ssrRenderStyle({ "background-color": "#faf4ed", "--shiki-dark-bg": "#1a1b26", "color": "#575279", "--shiki-dark": "#a9b1d6" })}" tabindex="0"><div class="copy-container"><div class="lang-symbol">bash</div><img${ssrRenderAttr("src", _imports_0)} class="copy-icon" data-code="npx wrangler deploy
"></div><code><span class="line"><span style="${ssrRenderStyle({ "color": "#D7827E", "--shiki-dark": "#C0CAF5" })}">npx</span><span style="${ssrRenderStyle({ "color": "#EA9D34", "--shiki-dark": "#9ECE6A" })}"> wrangler deploy</span></span>
<span class="line"></span></code></pre><p>成功提示 <img src="https://r2.ray-d-song.com/202312151618252.png" alt="success"></p><blockquote><p>本博客为服务端渲染, 客户端不会直接调用 worker 接口. 如果你的 app 是 spa, 请记得添加一些防刷操作和入参判断拦截.</p></blockquote></div>`);
    };
  }
};
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("src/page/post/cloudflare-d1.md");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
export {
  _sfc_main as default,
  intro,
  tag,
  time,
  title
};
